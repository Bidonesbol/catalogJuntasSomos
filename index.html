<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Juntas Somos</title>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-8W12SGRNJ8"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-8W12SGRNJ8');
  </script>
  
  <!-- Descripci√≥n para buscadores y previews (editable) -->
  <meta
    name="description"
    content="Campa√±a de Visibilidad en Diversidad."
  />

  <!-- Open Graph para previews en WhatsApp, Facebook, etc. -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://juntas-somos.org/" />
  <meta property="og:title" content="Juntas Somos ‚Äì Cat√°logo online" />
  <meta
    property="og:description"
    content="Campa√±a de Visibilidad en Diversidad."
  />
  <meta
    property="og:image"
    content="https://juntas-somos.org/images/logo-juntas-somos.png"
  />

  <!-- Twitter / X card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Juntas Somos ‚Äì Cat√°logo online" />
  <meta
    name="twitter:description"
    content="Campa√±a de Visibilidad en Diversidad."
  />
  <meta
    name="twitter:image"
    content="https://juntas-somos.org/images/logo-juntas-somos.png"
  />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="images/faviconJS.png" />
  <link rel="shortcut icon" type="image/png" href="images/faviconJS.png" />
  <style>
        /* Caviar Dreams ‚Äì Regular */
    @font-face {
      font-family: "Caviar Dreams";
      src: url("fonts/CaviarDreams.ttf") format("truetype");
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }
    
    /* Caviar Dreams ‚Äì Italic */
    @font-face {
      font-family: "Caviar Dreams";
      src: url("fonts/CaviarDreams_Italic.ttf") format("truetype");
      font-weight: 400;
      font-style: italic;
      font-display: swap;
    }
    
    /* Caviar Dreams ‚Äì Bold */
    @font-face {
      font-family: "Caviar Dreams";
      src: url("fonts/CaviarDreams_Bold.ttf") format("truetype");
      font-weight: 700;
      font-style: normal;
      font-display: swap;
    }
    
    /* Caviar Dreams ‚Äì Bold Italic */
    @font-face {
      font-family: "Caviar Dreams";
      src: url("fonts/CaviarDreams_BoldItalic.ttf") format("truetype");
      font-weight: 700;
      font-style: italic;
      font-display: swap;
    }

    :root {
      --primary: #9374b1;
      --primary-dark: #66448c;
      --bg: #f3f4f6;
      --text:rgb(102,68,140);
      --muted: #6b7280;
      --card-bg: #f5afcf;
      --border: #66448c;
      --radius-lg: 16px;
      --radius-md: 10px;
      --shadow-soft: 0 10px 25px rgba(15, 23, 42, 0.08);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Caviar Dreams", system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
    }
    header,
    header .logo,
    header a {
      color: #ffffff;
    }


    a {
      color: inherit;
      text-decoration: none;
    }

    img {
      max-width: 100%;
      display: block;
    }

    header {
      position: sticky;
      top: 0;
      z-index: 20;
      background: rgba(102, 68, 140, 0.7);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
    }

    .nav-inner {
      max-width: 1080px;
      margin: 0 auto;
      padding: 0.75rem 1.25rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }

    .logo {
      font-weight: 700;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      font-size: 0.9rem;
    }

    nav ul {
      list-style: none;
      display: flex;
      gap: 1rem;
      align-items: center;
      font-size: 0.9rem;
    }

    nav a {
      padding: 0.35rem 0.7rem;
      border-radius: 999px;
      transition: background 0.15s;
    }

    nav a:hover {
      background:rgb(102,68,140);
    }

    .cart-button {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.45rem 0.9rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgb(241,125,175);
      cursor: pointer;
      font-size: 0.9rem;
      box-shadow: 0 3px 10px rgba(15, 23, 42, 0.08);
    }

    .cart-button span.badge {
      background: rgb(162,34,125);
      color: white;
      border-radius: 999px;
      padding: 0.12rem 0.45rem;
      font-size: 0.75rem;
      min-width: 1.3rem;
      text-align: center;
    }

    main {
      max-width: 1080px;
      margin: 0 auto;
      padding: 1.5rem 1.25rem 3rem;
    }

    section {
      margin-bottom: 3rem;
    }

    #home {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.9fr);
      gap: 2rem;
      align-items: center;
    }

    #home h1 {
      font-size: clamp(2rem, 2.6vw, 2.6rem);
      margin-bottom: 0.75rem;
    }

    #home p.lead {
      color: var(--text);
      margin-bottom: 1.25rem;
    }

    .pill {
      display: inline-FLEX;
      align-items: center;
      gap: 0.4rem;
      background:rgb(245,175,206);
      color:rgb(102,68,140)
      padding: 0.25rem 0.7rem;
      border-radius: 999px;
      font-size: 0.75rem;
      margin-bottom: 0.9rem;
      font-weight: 550;
    }

    .hero-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-top: 1.25rem;
      align-items: center;
    }

    .hero-logo {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .hero-logo img {
      max-width: 100%;
      height: auto;
      display: block;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.4rem;
      padding: 0.6rem 1.2rem;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9rem;
      transition: background 0.15s, box-shadow 0.15s, transform 0.05s;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
      box-shadow: 0 10px 20px rgba(37, 99, 235, 0.35);
    }

    .btn-primary:hover {
      background: var(--primary-dark);
      box-shadow: 0 8px 18px rgba(37, 99, 235, 0.4);
      transform: translateY(-1px);
    }

    .btn-outline {
      background: rgb(241,125,175);
      color: var(--text);
      border: 1px solid var(--border);
    }

    .btn-outline:hover {
      background: rgb(236,65,131);
    }
    .btn-soldout {
      background: rgb(130,131,131);
      border-color: rgb(130,131,131);
      cursor: not-allowed;
      box-shadow: none;
    }

    .hero-panel {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-soft);
      padding: 1.25rem;
      border: 1px solid var(--border);
    }

    .hero-panel h2 {
      font-size: 1rem;
      margin-bottom: 0.5rem;
    }

    .hero-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.75rem;
      margin-top: 0.75rem;
    }

    .hero-mini-card {
      background: #f9fafb;
      padding: 0.75rem;
      border-radius: var(--radius-md);
      border: 1px dashed #e5e7eb;
      font-size: 0.8rem;
    }

    .hero-mini-card strong {
      display: block;
      margin-bottom: 0.2rem;
      font-size: 0.85rem;
    }

    #catalog h2,
    #how-it-works h2 {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }

    #catalog p.section-lead {
      color: var(--text);
      margin-bottom: 1.25rem;
      font-size: 0.95rem;
    }

    .catalog-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 1.25rem;
    }

    .product-card {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-soft);
      border: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .product-image {
      background: linear-gradient(135deg, #eff6ff, #f9fafb);
      font-size: 0.85rem;
      color: var(--text);
      text-align: center;
      padding: 0;
    }

    .product-image img {
      width: 100%;
      height: auto;
      display: block;
      object-fit: cover;
    }

    .product-body {
      padding: 0.9rem 0.9rem 0.75rem;
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      flex: 1;
    }

    .product-title {
      font-weight: 600;
      font-size: 0.95rem;
    }

    .product-description {
      font-size: 0.85rem;
      color: var(--text);
      flex: 1;
    }

    .product-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8rem;
      color: var(--text);
      margin-top: 0.4rem;
    }

    .product-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 0.7rem;
    }

    .product-actions button {
      font-size: 0.8rem;
      padding: 0.45rem 0.9rem;
    }

    .price-chip {
      background: #ecfdf5;
      color:rgb(162,34,125);
      border-radius: 999px;
      padding: 0.15rem 0.6rem;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .steps-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 1.25rem;
      margin-top: 1rem;
    }

    .step-card {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      padding: 0.9rem;
      border: 1px solid var(--border);
      box-shadow: 0 6px 15px rgba(15, 23, 42, 0.04);
      font-size: 0.9rem;
    }

    .step-number {
      width: 24px;
      height: 24px;
      border-radius: 999px;
      background: rgb(162,34,125);
      color: rgb(255,255,255);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      font-weight: 600;
      margin-bottom: 0.35rem;
    }

    .step-card h3 {
      font-size: 0.95rem;
      margin-bottom: 0.25rem;
    }

    .step-card p {
      color: var(--text);
      font-size: 0.85rem;
    }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.4);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 40;
      padding: 1rem;
    }

    .modal {
      max-width: 480px;
      width: 100%;
      background: var(--bg);
      border-radius: 18px;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.35);
      border: 1px solid var(--border);
      overflow: hidden;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
    }

    .modal-header {
      padding: 0.9rem 1rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.5rem;
    }

    .modal-header h2 {
      font-size: 1rem;
    }

    .modal-body {
      padding: 0.9rem 1rem 1rem;
      font-size: 0.9rem;
      overflow-y: auto;
      flex: 1;
    }

    #modalImageContainer {
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }

    #modalImageContainer img {
      max-height: 220px;
      width: auto;
      border-radius: 12px;
      margin-bottom: 0.5rem;
      object-fit: cover;
    }

    .modal-zoom-icon {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 24px;
      height: 24px;
      border-radius: 999px;
      border: none;
      background: rgba(0, 0, 0, 0.6);
      color: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      cursor: pointer;
      padding: 0;
    }

    /* Zoomed image overlay */
    #imageZoomBackdrop {
      cursor: zoom-out;
    }

    .image-zoom-wrapper {
      max-width: 90vw;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      justify-content: center;
      gap: 0.5rem;
    }

    .image-zoom-wrapper img {
      max-width: 100%;
      max-height: 85vh;
      border-radius: 16px;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.6);
      background: #000000;
    }

    .image-zoom-close {
      background: rgba(0, 0, 0, 0.6);
      color: #ffffff;
      border: none;
      border-radius: 999px;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 1.1rem;
    }

    .modal-footer {
      padding: 0.8rem 1rem;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .close-btn {
      background: transparent;
      border: none;
      cursor: pointer;
      font-size: 1.2rem;
      line-height: 1;
      color: var(--muted);
    }

    .modal-form-group {
      margin-bottom: 0.75rem;
    }

    .modal-form-group label {
      display: block;
      font-size: 0.8rem;
      margin-bottom: 0.2rem;
      color: var(--text);
    }

    select,
    input[type="number"],
    input[type="text"],
    textarea {
      width: 100%;
      padding: 0.4rem 0.5rem;
      font-size: 0.9rem;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: #f9fafb;
      outline: none;
      box-sizing: border-box;
    }

    select:focus,
    input[type="number"]:focus,
    input[type="text"]:focus,
    textarea:focus {
      border-color: var(--primary);
      background: white;
    }

    textarea {
      resize: vertical;
      min-height: 60px;
    }

    .inline-inputs {
      display: flex;
      gap: 0.6rem;
    }

    .cart-drawer {
      position: fixed;
      right: 0;
      top: 0;
      bottom: 0;
      width: min(360px, 100%);
      background: var(--bg);
      box-shadow: -10px 0 30px rgba(15, 23, 42, 0.25);
      transform: translateX(100%);
      transition: transform 0.2s ease-out;
      z-index: 35;
      display: flex;
      flex-direction: column;
    }

    .cart-drawer.open {
      transform: translateX(0%);
    }

    .cart-header {
      padding: 0.85rem 1rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .cart-header h2 {
      font-size: 1rem;
    }

    .cart-items {
      padding: 0.75rem 1rem;
      flex: 1;
      overflow-y: auto;
      font-size: 0.85rem;
    }

    .cart-item {
      border-bottom: 1px dashed var(--border);
      padding: 0.6rem 0;
      display: flex;
      justify-content: space-between;
      gap: 0.5rem;
    }

    .cart-item:last-child {
      border-bottom: none;
    }

    .cart-item-meta {
      color: var(--text);
      font-size: 0.8rem;
    }

    .remove-btn {
      background: transparent;
      border: none;
      color: #ef4444;
      font-size: 0.8rem;
      cursor: pointer;
      padding: 0;
    }

    .cart-footer {
      border-top: 1px solid var(--border);
      padding: 0.8rem 1rem 1rem;
      font-size: 0.9rem;
    }

    .checkout-form-group {
      margin-top: 0.5rem;
      font-size: 0.85rem;
    }

    .checkout-form-group label {
      display: block;
      margin-bottom: 0.2rem;
      color: var(--text);
    }

    #customerName,
    #customerDepartment {
      color: var(--text);
    }

    #customerName::placeholder {
      color: var(--muted);
    }

    .cart-summary {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.75rem;
    }

    .small-note {
      font-size: 0.8rem;
      color: var(--text);
      margin-top: 0.4rem;
    }

    .cart-footer .btn-primary {
      width: 100%;
      justify-content: center;
      margin-top: 0.25rem;
    }

    .tag {
      display: inline-flex;
      padding: 0.1rem 0.5rem;
      border-radius: 999px;
      font-size: 0.75rem;
      background: #fee2e2;
      color: #b91c1c;
      font-weight: 500;
    }

    @media (max-width: 900px) {
      #home {
        grid-template-columns: minmax(0, 1fr);
      }
      .hero-panel {
        order: -1;
      }
      .catalog-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
      .steps-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    @media (max-width: 640px) {
      .nav-inner {
        flex-wrap: wrap;
        justify-content: space-between;
      }
      .catalog-grid {
        grid-template-columns: minmax(0, 1fr);
      }
      .hero-actions {
        flex-direction: column;
        align-items: stretch;
      }
      .hero-actions .btn {
        width: 100%;
        justify-content: center;
      }
    }
  </style>
</head>
<body>
<header>
  <div class="nav-inner">
    <div class="logo">CAT√ÅLOGO ONLINE</div>
    <nav>
      <ul>
        <li><a href="#home">Inicio</a></li>
        <li><a href="#catalog">Cat√°logo</a></li>
        <li><a href="#how-it-works">C√≥mo funciona</a></li>
        <li>
          <button class="cart-button" id="openCartButton" type="button">
            üõí <span>Carrito</span>
            <span class="badge" id="cartCount">0</span>
          </button>
        </li>
      </ul>
    </nav>
  </div>
</header>

<main>
  <section id="home">
    <div>
      <div class="pill">
        üé® Tazas, stickers, pins y toma todo ¬∑ Bolivia
      </div>
      <h1>Haz tu pedido desde nuestro cat√°logo online.</h1>
      <p class="lead">
        Elige entre tazas, stickers, pins, toma todo y combos. Agrega al carrito y env√≠a tu pedido por WhatsApp.
        Nosotros coordinamos el pago y la entrega manualmente.
      </p>
      <div class="hero-actions">
        <button class="btn btn-primary" onclick="scrollToSection('catalog')">
          Ver cat√°logo completo ‚Üí
        </button>
        <button class="btn btn-outline" onclick="scrollToSection('how-it-works')">
          ¬øC√≥mo funciona?
        </button>
      </div>
    </div>
    <div class="hero-logo">
      <img src="images/logo-juntas-somos.png"
           alt="Juntes Somos ‚Äì Campa√±a de Visibilidad en Diversidad" />
    </div>
  </section>

  <section id="catalog">
    <h2>Cat√°logo</h2>
    <p class="section-lead">
      Haz clic en ‚ÄúVer‚Äù para abrir la ficha del producto, elegir variantes (si las hay) y agregar al carrito.
    </p>
    <div class="catalog-grid" id="catalogGrid"></div>
  </section>

  <section id="how-it-works">
    <h2>C√≥mo funciona el pedido</h2>
    <p style="color:var(--text);font-size:0.95rem;">
      No hay pago autom√°tico en el sitio. El carrito sirve para organizar el pedido y enviarlo por WhatsApp.
      Luego coordinamos todo contigo.
    </p>
    <div class="steps-grid">
      <div class="step-card">
        <div class="step-number">1</div>
        <h3>Explora los productos</h3>
        <p>Elige el tipo de producto (taza, sticker, pin, toma todo, combos) y revisa precios y opciones.</p>
      </div>
      <div class="step-card">
        <div class="step-number">2</div>
        <h3>Arma tu carrito</h3>
        <p>Selecciona variantes y cantidades. Puedes dejar notas en cada producto.</p>
      </div>
      <div class="step-card">
        <div class="step-number">3</div>
        <h3>Env√≠a el pedido</h3>
        <p>
          Env√≠a el detalle por WhatsApp. Te responderemos para confirmar el total, forma de pago
          y detalles de entrega.
        </p>
      </div>
    </div>
  </section>
</main>

<div class="modal-backdrop" id="productModalBackdrop">
  <div class="modal">
    <div class="modal-header">
      <h2 id="modalProductTitle"></h2>
      <button class="close-btn" type="button" onclick="closeProductModal()">√ó</button>
    </div>
    <div class="modal-body">
      <div id="modalImageContainer" style="margin-bottom:0.75rem;">
        <!-- imagen variante -->
      </div>
      <p id="modalProductDescription" style="margin-bottom:0.75rem;"></p>
      <div class="modal-form-group">
        <label for="variantSelect">Variante</label>
        <select id="variantSelect"></select>
      </div>
      <div class="modal-form-group inline-inputs">
        <div style="flex:1;">
          <label for="quantityInput">Cantidad</label>
          <input id="quantityInput" type="number" value="1" min="1" />
        </div>
        <div style="flex:1;">
          <label>Precio estimado</label>
          <div id="modalPricePreview" style="font-weight:600;font-size:0.95rem;">
            -
          </div>
        </div>
      </div>
      <div class="modal-form-group">
        <label for="noteInput">Nota opcional (nombre, dise√±o, referencia, etc.)</label>
        <textarea id="noteInput" placeholder="Ej: Dise√±o X, entregar solo tardes."></textarea>
      </div>
      <div class="small-note">
        <span class="tag">Importante</span>
        <br />
        El precio total y el costo de env√≠o se confirmar√°n manualmente por WhatsApp.
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" type="button" onclick="closeProductModal()">
        Cancelar
      </button>
      <button class="btn btn-primary" type="button" onclick="addModalProductToCart()">
        Agregar al carrito
      </button>
    </div>
  </div>
</div>

<div class="modal-backdrop" id="imageZoomBackdrop" style="display:none;">
  <div class="image-zoom-wrapper">
    <button class="image-zoom-close" type="button" onclick="closeImageZoom()">√ó</button>
    <img id="zoomedImage" src="" alt="" />
  </div>
</div>

<aside class="cart-drawer" id="cartDrawer">
  <div class="cart-header">
    <h2>Carrito</h2>
    <button class="close-btn" type="button" onclick="toggleCart(false)">√ó</button>
  </div>
  <div class="cart-items" id="cartItemsContainer"></div>
  <div class="cart-footer">
    <div class="cart-summary">
      <div>Total estimado</div>
      <div id="cartTotal"><strong>Bs 0</strong></div>
    </div>
    <div class="checkout-form-group">
      <label for="customerName">Nombre</label>
      <input type="text" id="customerName" placeholder="Tu nombre" />
    </div>
    <div class="checkout-form-group">
      <label for="customerDepartment">Departamento</label>
      <select id="customerDepartment">
        <option value="">Selecciona una opci√≥n</option>
        <option value="La Paz">La Paz</option>
        <option value="Santa Cruz">Santa Cruz</option>
        <option value="Cochabamba">Cochabamba</option>
        <option value="Beni">Beni</option>
        <option value="Chuquisaca">Chuquisaca</option>
        <option value="Oruro">Oruro</option>
        <option value="Pando">Pando</option>
        <option value="Potos√≠">Potos√≠</option>
        <option value="Tarija">Tarija</option>
        <option value="Fuera de Bolivia">Fuera de Bolivia</option>
      </select>
    </div>
    <div class="small-note">
      El total es de referencia. El precio final y el env√≠o se confirman por WhatsApp.
    </div>
    <button class="btn btn-primary" type="button" onclick="sendOrderViaWhatsApp()">
      Enviar pedido por WhatsApp
    </button>
    <button class="btn btn-outline" type="button" onclick="clearCart()" style="margin-top:0.35rem;">
      Vaciar carrito
    </button>
  </div>
</aside>

<script>
  // ‚ö†Ô∏è CAMBIA ESTE N√öMERO AL TUYO (sin +, sin espacios)
  const WHATSAPP_NUMBER = "59176666946";
  //const WHATSAPP_NUMBER = "59163199327";

  function trackEvent(name, params = {}) {
    if (typeof gtag === "function") {
      gtag("event", name, params);
    }
  }

  // Helpers for sold-out logic
  function isProductSoldOut(product) {
    // Product is sold out if the product flag is true OR all variants are sold out
    if (product.soldOut) return true;
    if (!product.variants || product.variants.length === 0) return false;
    return product.variants.every(v => v.soldOut);
  }

  function isVariantSoldOut(product, variantId) {
    const v = product.variants.find(v => v.id === variantId);
    return v ? !!v.soldOut : false;
  }

  function getFirstAvailableVariant(product) {
    if (!product.variants || product.variants.length === 0) return null;
    const available = product.variants.find(v => !v.soldOut);
    return available || product.variants[0];
  }

  // Productos con im√°genes seg√∫n tus nombres de archivo
  // Agregamos flags soldOut a nivel de producto y variante
  const products = [
    {
      id: "taza11",
      name: "Taza 11 oz",
      description: "Taza de cer√°mica 11 oz, ideal para caf√© o t√©.",
      baseImageText: "Taza 11 oz",
      baseImage: "images/taza11-main.jpg",
      soldOut: false, // marcar true si TODO el producto est√° agotado
      variants: [
        {
          id: "taza11-std",
          name: "Taza 11 oz",
          price: 60,
          image: "images/taza11-std.jpg",
          soldOut: false // marcar true si esta variante est√° agotada
        }
      ]
    },
    {
      id: "taza6",
      name: "Taza 6 oz",
      description: "Taza de cer√°mica 6 oz, perfecta para espresso o porciones peque√±as.",
      baseImageText: "Taza 6 oz",
      baseImage: "images/taza6-main.jpg",
      soldOut: false,
      variants: [
        {
          id: "taza6-std",
          name: "Taza 6 oz",
          price: 50,
          image: "images/taza6-std.jpg",
          soldOut: false
        }
      ]
    },
    {
      id: "stickers",
      name: "Stickers",
      description: "Stickers con ilustraciones. Puedes pedir stickers sueltos o una hoja completa.",
      baseImageText: "Stickers individuales o en hoja",
      baseImage: "images/stickers-main.jpg",
      soldOut: false,
      variants: [
        {
          id: "stickers-unit",
          name: "Sticker individual",
          price: 5,
          image: "images/stickers-unit.jpg",
          soldOut: false
        },
        {
          id: "stickers-page",
          name: "Hoja completa de stickers",
          price: 20,
          image: "images/stickers-page.jpg",
          soldOut: false
        }
      ]
    },
    {
      id: "pins",
      name: "Pins",
      description: "Pins con distintos dise√±os. Cualquier variante tiene el mismo precio.",
      baseImageText: "Pins con distintos dise√±os",
      baseImage: "images/pins-main.jpg",
      soldOut: false,
      variants: [
        {
          id: "pins-var1",
          name: "Pin dise√±o A",
          price: 15,
          image: "images/pins-var1.jpg",
          soldOut: false
        },
        {
          id: "pins-var2",
          name: "Pin dise√±o B",
          price: 15,
          image: "images/pins-var2.jpg",
          soldOut: false
        },
        {
          id: "pins-var3",
          name: "Pin dise√±o C",
          price: 15,
          image: "images/pins-var3.jpg",
          soldOut: false
        }
      ]
    },
    {
      id: "toma-todo",
      name: "Toma todo",
      description: "Toma todo (vaso/jarro especial). Cualquier dise√±o se maneja como la misma variante.",
      baseImageText: "Toma todo",
      baseImage: "images/toma-todo-main.jpg",
      soldOut: false,
      variants: [
        {
          id: "toma-todo-std",
          name: "Toma todo",
          price: 100,
          image: "images/toma-todo-std.jpg",
          soldOut: false
        }
      ]
    },
    {
      id: "combos",
      name: "Combos",
      description: "Combos especiales con combinaciones de tazas, stickers y pins.",
      baseImageText: "Combos promocionales",
      baseImage: "images/combos-main.jpg",
      soldOut: false,
      variants: [
        {
          id: "combo1",
          name: "Combo 1: Taza 11 oz + Sticker + Pin",
          price: 75,
          image: "images/combo1.jpg",
          soldOut: false
        },
        {
          id: "combo2",
          name: "Combo 2: Taza 6 oz + Sticker + Pin",
          price: 65,
          image: "images/combo2.jpg",
          soldOut: false
        },
        {
          id: "combo3",
          name: "Combo 3: Sticker + Pin",
          price: 15,
          image: "images/combo3.jpg",
          soldOut: false
        },
        {
          id: "combo4",
          name: "Combo 4: Taza 11 oz + Taza 6 oz + Sticker + Pin",
          price: 120,
          image: "images/combo4.jpg",
          soldOut: false
        }
      ]
    }
  ];

  let cart = [];
  let currentProduct = null;

  function renderCatalog() {
    const grid = document.getElementById("catalogGrid");
    grid.innerHTML = "";

    products.forEach((product) => {
      const minPrice = Math.min(...product.variants.map((v) => v.price));
      const numVariants = product.variants.length;
      const productSoldOut = isProductSoldOut(product);

      const card = document.createElement("article");
      card.className = "product-card";
      card.innerHTML = `
        <div class="product-image">
          ${
            product.baseImage
              ? `<img src="${product.baseImage}" alt="${product.name}" />`
              : `<span>${product.baseImageText || "Imagen del producto"}</span>`
          }
        </div>
        <div class="product-body">
          <div class="product-title">${product.name}</div>
          <div class="product-description">${product.description}</div>
          <div class="product-meta">
            <span>${numVariants === 1 ? "1 variante" : numVariants + " variantes"}</span>
            <span class="price-chip">Desde Bs ${minPrice}</span>
          </div>
          <div class="product-actions">
            ${
              productSoldOut
                ? `
                  <button class="btn btn-soldout" type="button" disabled>
                    Agotado
                  </button>
                `
                : `
                  <button class="btn btn-outline" type="button"
                    onclick="openProductModal('${product.id}')">
                    Ver
                  </button>
                  <button class="btn btn-primary" type="button"
                    onclick="quickAddFirstVariant('${product.id}')">
                    Agregar r√°pido
                  </button>
                `
            }
          </div>
        </div>
      `;
      grid.appendChild(card);
    });
  }

  function openProductModal(productId) {
    const product = products.find((p) => p.id === productId);
    if (!product) return;

    const productSoldOut = isProductSoldOut(product);
    if (productSoldOut) {
      alert("Este producto est√° agotado.");
      return;
    }

    currentProduct = product;

    trackEvent("view_product_detail", {
      product_id: product.id,
      product_name: product.name
    });

    const backdrop = document.getElementById("productModalBackdrop");
    const titleEl = document.getElementById("modalProductTitle");
    const descEl = document.getElementById("modalProductDescription");
    const variantSelect = document.getElementById("variantSelect");
    const quantityInput = document.getElementById("quantityInput");
    const noteInput = document.getElementById("noteInput");
    const imageContainer = document.getElementById("modalImageContainer");

    titleEl.textContent = product.name;
    descEl.textContent = product.description;
    quantityInput.value = 1;
    noteInput.value = "";

    // Rellenar variantes considerando estado soldOut
    variantSelect.innerHTML = "";
    product.variants.forEach((variant) => {
      const option = document.createElement("option");
      option.value = variant.id;

      const soldText = variant.soldOut ? " (AGOTADO)" : "";
      option.textContent = `${variant.name} ¬∑ Bs ${variant.price}${soldText}`;
      if (variant.soldOut) {
        option.disabled = true;
      }

      variantSelect.appendChild(option);
    });

    // Seleccionar la primera variante disponible
    const firstAvailable = getFirstAvailableVariant(product);
    if (firstAvailable) {
      variantSelect.value = firstAvailable.id;
    }

    // Mostrar imagen de la variante seleccionada o base
    const selectedVariant = product.variants.find(v => v.id === variantSelect.value);
    if (selectedVariant && selectedVariant.image) {
      imageContainer.innerHTML = `
        <img src="${selectedVariant.image}" alt="${selectedVariant.name}" />
        <button type="button" class="modal-zoom-icon" aria-label="Ver imagen m√°s grande" onclick="openImageZoom(event)">üîç</button>
      `;
      imageContainer.onclick = openImageZoom;
    } else if (product.baseImage) {
      imageContainer.innerHTML = `
        <img src="${product.baseImage}" alt="${product.name}" />
        <button type="button" class="modal-zoom-icon" aria-label="Ver imagen m√°s grande" onclick="openImageZoom(event)">üîç</button>
      `;
      imageContainer.onclick = openImageZoom;
    } else {
      imageContainer.innerHTML = "";
      imageContainer.onclick = null;
    }

    updateModalPricePreview();
    backdrop.style.display = "flex";
  }

  function closeProductModal() {
    const backdrop = document.getElementById("productModalBackdrop");
    backdrop.style.display = "none";
    currentProduct = null;
  }

  function updateModalPricePreview() {
    if (!currentProduct) return;
    const variantSelect = document.getElementById("variantSelect");
    const quantityInput = document.getElementById("quantityInput");
    const pricePreview = document.getElementById("modalPricePreview");
    const imageContainer = document.getElementById("modalImageContainer");

    const variant = currentProduct.variants.find(
      (v) => v.id === variantSelect.value
    );
    const qty = Math.max(1, parseInt(quantityInput.value, 10) || 1);

    if (!variant || variant.soldOut) {
      pricePreview.textContent = "-";
      if (currentProduct.baseImage) {
        imageContainer.innerHTML = `
          <img src="${currentProduct.baseImage}" alt="${currentProduct.name}" />
          <button type="button" class="modal-zoom-icon" aria-label="Ver imagen m√°s grande" onclick="openImageZoom(event)">üîç</button>
        `;
        imageContainer.onclick = openImageZoom;
      } else {
        imageContainer.innerHTML = "";
        imageContainer.onclick = null;
      }
      return;
    }

    const total = variant.price * qty;
    pricePreview.textContent = `Bs ${total}`;

    if (variant.image) {
      imageContainer.innerHTML = `
        <img src="${variant.image}" alt="${variant.name}" />
        <button type="button" class="modal-zoom-icon" aria-label="Ver imagen m√°s grande" onclick="openImageZoom(event)">üîç</button>
      `;
      imageContainer.onclick = openImageZoom;
    } else if (currentProduct.baseImage) {
      imageContainer.innerHTML = `
        <img src="${currentProduct.baseImage}" alt="${currentProduct.name}" />
        <button type="button" class="modal-zoom-icon" aria-label="Ver imagen m√°s grande" onclick="openImageZoom(event)">üîç</button>
      `;
      imageContainer.onclick = openImageZoom;
    } else {
      imageContainer.innerHTML = "";
      imageContainer.onclick = null;
    }
  }

  function openImageZoom(event) {
    if (event) {
      event.stopPropagation();
    }
    const img = document.querySelector("#modalImageContainer img");
    if (!img) return;

    trackEvent("open_image_zoom", {
      image_src: img.src,
      image_alt: img.alt || "",
      product_id: currentProduct ? currentProduct.id : null
    });

    const zoomBackdrop = document.getElementById("imageZoomBackdrop");
    const zoomImg = document.getElementById("zoomedImage");
    zoomImg.src = img.src;
    zoomImg.alt = img.alt || "";
    zoomBackdrop.style.display = "flex";
  }

  function closeImageZoom() {
    const zoomBackdrop = document.getElementById("imageZoomBackdrop");
    const zoomImg = document.getElementById("zoomedImage");
    zoomBackdrop.style.display = "none";
    zoomImg.src = "";
  }

  document
    .getElementById("variantSelect")
    .addEventListener("change", updateModalPricePreview);

  document
    .getElementById("quantityInput")
    .addEventListener("input", updateModalPricePreview);

  function addModalProductToCart() {
    if (!currentProduct) return;
    const variantSelect = document.getElementById("variantSelect");
    const quantityInput = document.getElementById("quantityInput");
    const noteInput = document.getElementById("noteInput");

    const variantId = variantSelect.value;
    const variant = currentProduct.variants.find(v => v.id === variantId);

    if (!variant || variant.soldOut || currentProduct.soldOut) {
      alert("Esta variante est√° agotada.");
      return;
    }

    const qty = Math.max(1, parseInt(quantityInput.value, 10) || 1);
    const note = noteInput.value.trim();

    cart.push({
      productId: currentProduct.id,
      variantId,
      quantity: qty,
      note
    });

    trackEvent("add_to_cart", {
      product_id: currentProduct.id,
      product_name: currentProduct.name,
      variant_id: variant.id,
      variant_name: variant.name,
      quantity: qty,
      line_total: variant.price * qty
    });

    updateCartUI();
    closeProductModal();
    toggleCart(true);
  }

  function quickAddFirstVariant(productId) {
    const product = products.find((p) => p.id === productId);
    if (!product) return;

    if (isProductSoldOut(product)) {
      alert("Este producto est√° agotado.");
      return;
    }

    const firstAvailable = getFirstAvailableVariant(product);
    if (!firstAvailable || firstAvailable.soldOut) {
      alert("Este producto est√° agotado.");
      return;
    }

    cart.push({
      productId: product.id,
      variantId: firstAvailable.id,
      quantity: 1,
      note: ""
    });

    trackEvent("quick_add_product", {
      product_id: product.id,
      product_name: product.name,
      variant_id: firstAvailable.id,
      variant_name: firstAvailable.name,
      price: firstAvailable.price,
      quantity: 1
    });

    updateCartUI();
    toggleCart(true);
  }

  function toggleCart(open) {
    const drawer = document.getElementById("cartDrawer");
    let willBeOpen;

    if (typeof open === "boolean") {
      willBeOpen = open;
      drawer.classList.toggle("open", open);
    } else {
      willBeOpen = !drawer.classList.contains("open");
      drawer.classList.toggle("open");
    }

    if (willBeOpen) {
      trackEvent("open_cart", {
        cart_items_count: cart.length
      });
    }
  }

  function updateCartUI() {
    const countEl = document.getElementById("cartCount");
    const itemsContainer = document.getElementById("cartItemsContainer");
    const totalEl = document.getElementById("cartTotal");

    countEl.textContent = cart.length;

    if (cart.length === 0) {
      itemsContainer.innerHTML =
        '<p style="color:var(--muted);font-size:0.9rem;">Tu carrito est√° vac√≠o.</p>';
      totalEl.innerHTML = "<strong>Bs 0</strong>";
      return;
    }

    itemsContainer.innerHTML = "";
    let total = 0;

    cart.forEach((item, index) => {
      const product = products.find((p) => p.id === item.productId);
      const variant = product
        ? product.variants.find((v) => v.id === item.variantId)
        : null;

      const name = product ? product.name : "Producto";
      const variantName = variant ? variant.name : "Variante";
      const price = variant ? variant.price : 0;
      const lineTotal = price * item.quantity;
      total += lineTotal;

      const div = document.createElement("div");
      div.className = "cart-item";
      div.innerHTML = `
        <div>
          <div><strong>${name}</strong></div>
          <div class="cart-item-meta">
            ${variantName} ¬∑ Cant: ${item.quantity} ¬∑ Bs ${price} c/u
            ${
              item.note
                ? `<br /><span style="font-style:italic;">Nota: ${item.note}</span>`
                : ""
            }
          </div>
        </div>
        <div style="text-align:right;">
          <div><strong>Bs ${lineTotal}</strong></div>
          <button class="remove-btn" type="button" onclick="removeCartItem(${index})">
            Quitar
          </button>
        </div>
      `;
      itemsContainer.appendChild(div);
    });

    totalEl.innerHTML = `<strong>Bs ${total}</strong>`;
  }

  function removeCartItem(index) {
    const item = cart[index];

    if (item) {
      const product = products.find((p) => p.id === item.productId);
      const variant = product
        ? product.variants.find((v) => v.id === item.variantId)
        : null;
      const price = variant ? variant.price : 0;
      const lineTotal = price * item.quantity;

      trackEvent("remove_from_cart", {
        product_id: item.productId,
        product_name: product ? product.name : "Producto",
        variant_id: item.variantId,
        variant_name: variant ? variant.name : "Variante",
        quantity: item.quantity,
        line_total: lineTotal
      });
    }

    cart.splice(index, 1);
    updateCartUI();
  }

  function clearCart() {
    if (!confirm("¬øVaciar el carrito?")) return;

    let previousTotal = 0;
    cart.forEach((item) => {
      const product = products.find((p) => p.id === item.productId);
      const variant = product
        ? product.variants.find((v) => v.id === item.variantId)
        : null;
      const price = variant ? variant.price : 0;
      previousTotal += price * item.quantity;
    });

    trackEvent("clear_cart", {
      previous_items_count: cart.length,
      previous_total: previousTotal
    });

    cart = [];
    updateCartUI();
    const nameInput = document.getElementById("customerName");
    const deptSelect = document.getElementById("customerDepartment");
    if (nameInput) nameInput.value = "";
    if (deptSelect) deptSelect.value = "";
  }

  function sendOrderViaWhatsApp() {
    if (cart.length === 0) {
      alert("El carrito est√° vac√≠o.");
      return;
    }

    const nameInput = document.getElementById("customerName");
    const deptSelect = document.getElementById("customerDepartment");
    const customerName = nameInput ? nameInput.value.trim() : "";
    const department = deptSelect ? deptSelect.value : "";

    if (!department) {
      alert("Por favor, selecciona tu departamento antes de enviar el pedido.");
      return;
    }

    const greeting = customerName
      ? `Hola, soy ${customerName} y quiero hacer el siguiente pedido desde el cat√°logo:\n`
      : "Hola, quiero hacer el siguiente pedido desde el cat√°logo:\n";

    let message = greeting + `Departamento: ${department}\n\n`;

    let total = 0;
    cart.forEach((item, i) => {
      const product = products.find((p) => p.id === item.productId);
      const variant = product
        ? product.variants.find((v) => v.id === item.variantId)
        : null;

      const name = product ? product.name : "Producto";
      const variantName = variant ? variant.name : "Variante";
      const price = variant ? variant.price : 0;
      const lineTotal = price * item.quantity;
      total += lineTotal;

      message += `${i + 1}. ${name} (${variantName})\n`;
      message += `   Cantidad: ${item.quantity}\n`;
      message += `   Precio unitario: Bs ${price}\n`;
      message += `   Subtotal: Bs ${lineTotal}\n`;
      if (item.note) {
        message += `   Nota: ${item.note}\n`;
      }
      message += "\n";
    });

    message += `Total estimado (sin env√≠o): Bs ${total}\n\n`;
    message +=
      "Por favor, confirmen el total final, forma de pago y costo/env√≠o. Gracias.";

    trackEvent("send_order_whatsapp", {
      cart_items_count: cart.length,
      estimated_total: total,
      department: department || "N/A",
      has_name: !!customerName
    });

    const url =
      "https://wa.me/" +
      WHATSAPP_NUMBER +
      "?text=" +
      encodeURIComponent(message);

    window.open(url, "_blank");
  }

  function scrollToSection(id) {
    const section = document.getElementById(id);
    if (!section) return;

    trackEvent("scroll_to_section", {
      section_id: id
    });

    section.scrollIntoView({ behavior: "smooth" });
  }

  document
    .getElementById("openCartButton")
    .addEventListener("click", () => toggleCart(true));

  document
    .getElementById("productModalBackdrop")
    .addEventListener("click", (e) => {
      if (e.target.id === "productModalBackdrop") {
        closeProductModal();
      }
    });

  document
    .getElementById("imageZoomBackdrop")
    .addEventListener("click", (e) => {
      if (e.target.id === "imageZoomBackdrop") {
        closeImageZoom();
      }
    });

  renderCatalog();
  updateCartUI();
</script>
<footer style="margin-top:2rem; padding:1.5rem 0; text-align:center; color:var(--text); font-size:0.9rem;">
  <div style="display:flex; align-items:center; justify-content:center; margin-bottom:0.4rem;">
    <img src="images/chifleriaLogo.jpg" alt="La Chifleria Logo" style="height:50px; width:50px; border-radius:50%; object-fit:cover; box-shadow:0 2px 6px rgba(0,0,0,0.18);" />
  </div>
  <div style="display:flex; gap:1rem; justify-content:center; margin-top:0.25rem;">
    <a
      href="https://www.facebook.com/profile.php?id=61576505622329"
      target="_blank"
      rel="noopener"
      style="color:var(--text); text-decoration:underline;"
      onclick="trackEvent('click_social_link', { platform: 'facebook', url: this.href });"
    >
      Facebook
    </a>
    <a
      href="https://www.instagram.com/la_chifleria_bo/"
      target="_blank"
      rel="noopener"
      style="color:var(--text); text-decoration:underline;"
      onclick="trackEvent('click_social_link', { platform: 'instagram', url: this.href });"
    >
      Instagram
    </a>
  </div>
</footer>
</body>
</html>
